/*! For license information please see cb8f334b.aec2d05a.js.LICENSE.txt */
"use strict";(self.webpackChunkdocs_site=self.webpackChunkdocs_site||[]).push([[638],{467:(e,n,r)=>{function t(e,n,r,t,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?n(c):Promise.resolve(c).then(t,i)}function i(e){return function(){var n=this,r=arguments;return new Promise(function(i,a){var o=e.apply(n,r);function s(e){t(o,i,a,s,c,"next",e)}function c(e){t(o,i,a,s,c,"throw",e)}s(void 0)})}}r.d(n,{A:()=>i})},2444:(e,n,r)=>{function t(e,n,r,i){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,n,r,i){function o(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?a?a(e,n,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[n]=r:(o("next",0),o("throw",1),o("return",2))},t(e,n,r,i)}function i(){var e,n,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function s(r,i,a,o){var s=i&&i.prototype instanceof l?i:l,d=Object.create(s.prototype);return t(d,"_invoke",function(r,t,i){var a,o,s,l=0,d=i||[],u=!1,m={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(n,r){return a=n,o=0,s=e,m.n=r,c}};function p(r,t){for(o=r,s=t,n=0;!u&&l&&!i&&n<d.length;n++){var i,a=d[n],p=m.p,v=a[2];r>3?(i=v===t)&&(s=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=e):a[0]<=p&&((i=r<2&&p<a[1])?(o=0,m.v=t,m.n=a[1]):p<v&&(i=r<3||a[0]>t||t>v)&&(a[4]=r,a[5]=t,m.n=v,o=0))}if(i||r>1)return c;throw u=!0,t}return function(i,d,v){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&p(d,v),o=d,s=v;(n=o<2?e:s)||!u;){a||(o?o<3?(o>1&&(m.n=-1),p(o,s)):m.n=s:m.v=s);try{if(l=2,a){if(o||(i="next"),n=a[i]){if(!(n=n.call(a,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,o<2&&(o=0)}else 1===o&&(n=a.return)&&n.call(a),o<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),o=1);a=e}else if((n=(u=m.n<0)?s:r.call(t,m))!==c)break}catch(n){a=e,o=1,s=n}finally{l=1}}return{value:n,done:u}}}(r,a,o),!0),d}var c={};function l(){}function d(){}function u(){}n=Object.getPrototypeOf;var m=[][a]?n(n([][a]())):(t(n={},a,function(){return this}),n),p=u.prototype=l.prototype=Object.create(m);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,t(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return d.prototype=u,t(p,"constructor",u),t(u,"constructor",d),d.displayName="GeneratorFunction",t(u,o,"GeneratorFunction"),t(p),t(p,o,"Generator"),t(p,a,function(){return this}),t(p,"toString",function(){return"[object Generator]"}),(i=function(){return{w:s,m:v}})()}r.d(n,{A:()=>i})},5257:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>p,contentTitle:()=>m,default:()=>h,frontMatter:()=>u,metadata:()=>t,toc:()=>v});const t=JSON.parse('{"id":"implementation/service-layer","title":"Service Layer Architecture","description":"The service layer provides clean abstractions for external APIs, making the application maintainable and testable. This pattern separates business logic from UI concerns and enables easy mocking during development.","source":"@site/docs/implementation/service-layer.md","sourceDirName":"implementation","slug":"/implementation/service-layer","permalink":"/smugmug-api-reference-app/implementation/service-layer","draft":false,"unlisted":false,"editUrl":"https://github.com/signal-x-studio/smugmug-api-reference-app/tree/main/docs-site/docs/implementation/service-layer.md","tags":[],"version":"current","lastUpdatedBy":"Abelino Chavez","lastUpdatedAt":1759015750000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"React Component Patterns","permalink":"/smugmug-api-reference-app/implementation/react-patterns"}}');var i=r(4848),a=r(8453),o=r(2444),s=r(467),c=r(6540),l=r(4164);function d(e){var n=e.code,r=e.language,t=void 0===r?"typescript":r,a=e.title,d=e.description,u=e.highlightLines,m=void 0===u?[]:u,p=e.copyable,v=void 0===p||p,g=(0,c.useState)(!1),h=g[0],y=g[1],f=function(){var e=(0,s.A)((0,o.A)().m(function e(){var r;return(0,o.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,navigator.clipboard.writeText(n);case 1:y(!0),setTimeout(function(){return y(!1)},2e3),e.n=3;break;case 2:e.p=2,r=e.v,console.error("Failed to copy code:",r);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(){return e.apply(this,arguments)}}();return(0,i.jsxs)("div",{className:"interactive-code-block margin-bottom--md",children:[(a||d)&&(0,i.jsxs)("div",{className:"code-block-header padding--sm",children:[a&&(0,i.jsx)("h4",{className:"margin-bottom--xs",children:a}),d&&(0,i.jsx)("p",{className:"margin-bottom--none text--secondary",children:d})]}),(0,i.jsxs)("div",{className:"position-relative",children:[(0,i.jsx)("pre",{className:(0,l.A)("prism-code","language-"+t),children:(0,i.jsx)("code",{children:n.split("\n").map(function(e,n){return(0,i.jsxs)("span",{className:(0,l.A)("code-line",m.includes(n+1)&&"docusaurus-highlight-code-line"),children:[e,"\n"]},n)})})}),v&&(0,i.jsx)("button",{className:(0,l.A)("clean-btn","copy-code-button","position-absolute",h&&"copy-code-button--copied"),onClick:f,title:h?"Copied!":"Copy code",style:{top:"8px",right:"8px",padding:"4px 8px",backgroundColor:h?"#28a745":"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"4px",fontSize:"12px"},children:h?"\u2713":"\ud83d\udccb"})]})]})}const u={sidebar_position:3},m="Service Layer Architecture",p={},v=[{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Mock Service Pattern",id:"mock-service-pattern",level:2},{value:"Mock Service Implementation",id:"mock-service-implementation",level:3},{value:"Benefits of Mock Service Pattern",id:"benefits-of-mock-service-pattern",level:3},{value:"AI Service Integration",id:"ai-service-integration",level:2},{value:"Core AI Service Structure",id:"core-ai-service-structure",level:3},{value:"Error Handling Patterns",id:"error-handling-patterns",level:2},{value:"Consistent Error Response Structure",id:"consistent-error-response-structure",level:3},{value:"Retry Logic Implementation",id:"retry-logic-implementation",level:3},{value:"Service Configuration",id:"service-configuration",level:2},{value:"Environment-Based Configuration",id:"environment-based-configuration",level:3},{value:"Service Factory Pattern",id:"service-factory-pattern",level:3},{value:"Testing Service Layer",id:"testing-service-layer",level:2},{value:"Service Testing Patterns",id:"service-testing-patterns",level:3}];function g(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"service-layer-architecture",children:"Service Layer Architecture"})}),"\n",(0,i.jsx)(n.p,{children:"The service layer provides clean abstractions for external APIs, making the application maintainable and testable. This pattern separates business logic from UI concerns and enables easy mocking during development."}),"\n","\n",(0,i.jsx)(d,{code:"// Service layer structure\nservices/\n\u251c\u2500\u2500 geminiService.ts      # AI/Gemini Vision integration\n\u251c\u2500\u2500 mockSmugMugService.ts # Development mock service (active)\n\u2514\u2500\u2500 smugmugService.ts     # OAuth reference implementation",language:"bash",title:"\ud83d\udcc1 Service Architecture",description:"Clean separation of concerns with dedicated service files"}),"\n",(0,i.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,i.jsx)(n.h2,{id:"mock-service-pattern",children:"Mock Service Pattern"}),"\n",(0,i.jsx)(n.p,{children:"During development, the application uses a mock service that simulates SmugMug API behavior without requiring OAuth setup or external dependencies."}),"\n",(0,i.jsx)(n.h3,{id:"mock-service-implementation",children:"Mock Service Implementation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// services/mockSmugMugService.ts\nimport { SmugMugService, Album, Photo, SmugMugNode } from '../types';\n\nclass MockSmugMugService implements SmugMugService {\n  async getCurrentUser() {\n    // Simulate API delay\n    await this.delay(500);\n    \n    return {\n      id: 'mock-user-123',\n      name: 'Demo User',\n      nickname: 'demo',\n      email: 'demo@example.com'\n    };\n  }\n\n  async getNodeTree(): Promise<SmugMugNode[]> {\n    await this.delay(800);\n    \n    return [\n      {\n        id: 'node-1',\n        name: 'Travel Photos',\n        type: 'folder',\n        children: [\n          { id: 'album-1', name: 'Europe 2023', type: 'album' },\n          { id: 'album-2', name: 'Japan Trip', type: 'album' }\n        ]\n      },\n      {\n        id: 'node-2', \n        name: 'Family',\n        type: 'folder',\n        children: [\n          { id: 'album-3', name: 'Holiday Gatherings', type: 'album' }\n        ]\n      }\n    ];\n  }\n\n  async getAlbumPhotos(albumId: string): Promise<Photo[]> {\n    await this.delay(600);\n    \n    // Generate mock photos based on album\n    const photoCount = Math.floor(Math.random() * 20) + 5;\n    const photos: Photo[] = [];\n    \n    for (let i = 1; i <= photoCount; i++) {\n      photos.push({\n        id: `${albumId}-photo-${i}`,\n        title: `Photo ${i}`,\n        filename: `IMG_${1000 + i}.jpg`,\n        url: `https://picsum.photos/800/600?random=${albumId}-${i}`,\n        thumbnailUrl: `https://picsum.photos/200/150?random=${albumId}-${i}`,\n        uploadDate: this.randomDate(),\n        status: this.randomStatus()\n      });\n    }\n    \n    return photos;\n  }\n\n  private async delay(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  private randomDate(): string {\n    const start = new Date(2023, 0, 1);\n    const end = new Date();\n    const date = new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));\n    return date.toISOString();\n  }\n\n  private randomStatus(): PhotoStatus {\n    const statuses = [\n      PhotoStatus.Uploaded,\n      PhotoStatus.AIProcessed, \n      PhotoStatus.ReviewNeeded,\n      PhotoStatus.Approved\n    ];\n    return statuses[Math.floor(Math.random() * statuses.length)];\n  }\n}\n\nexport const smugmugService = new MockSmugMugService();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"benefits-of-mock-service-pattern",children:"Benefits of Mock Service Pattern"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Development Independence"}),": No external API dependencies during development"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Predictable Testing"}),": Consistent data for UI testing and development"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Performance"}),": Fast responses without network delays"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cost Efficiency"}),": No API usage costs during development"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Offline Development"}),": Works without internet connectivity"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"ai-service-integration",children:"AI Service Integration"}),"\n",(0,i.jsx)(n.p,{children:"The Gemini service demonstrates production-ready AI integration with proper error handling and structured responses."}),"\n",(0,i.jsx)(n.h3,{id:"core-ai-service-structure",children:"Core AI Service Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// services/geminiService.ts\nimport { GoogleGenerativeAI } from '@google/genai';\n\nexport class GeminiService {\n  private genAI: GoogleGenerativeAI;\n  private model: any;\n\n  constructor(apiKey: string) {\n    this.genAI = new GoogleGenerativeAI(apiKey);\n    this.model = this.genAI.getGenerativeModel({ \n      model: \"gemini-1.5-flash\",\n      generationConfig: {\n        responseMimeType: \"application/json\"\n      }\n    });\n  }\n\n  async generatePhotoMetadata(\n    image: File, \n    customInstructions: string = ''\n  ): Promise<ImageMetadata> {\n    try {\n      // Convert image to proper format\n      const imagePart = await this.fileToGenerativePart(image);\n      \n      // Build structured prompt\n      const prompt = this.buildMetadataPrompt(customInstructions);\n      \n      // Generate with schema enforcement\n      const result = await this.model.generateContent([prompt, imagePart]);\n      const responseText = result.response.text();\n      \n      // Parse and validate response\n      const metadata = JSON.parse(responseText) as ImageMetadata;\n      this.validateMetadata(metadata);\n      \n      return metadata;\n      \n    } catch (error) {\n      throw this.handleAIError(error);\n    }\n  }\n\n  private validateMetadata(metadata: any): void {\n    const required = ['title', 'description', 'keywords'];\n    \n    for (const field of required) {\n      if (!metadata[field]) {\n        throw new Error(`Missing required field: ${field}`);\n      }\n    }\n    \n    if (!Array.isArray(metadata.keywords)) {\n      throw new Error('Keywords must be an array');\n    }\n  }\n\n  private handleAIError(error: any): Error {\n    if (error.message?.includes('quota')) {\n      return new Error('AI service quota exceeded. Please try again later.');\n    } else if (error.message?.includes('invalid')) {\n      return new Error('Invalid image format. Please use JPEG, PNG, or WebP.');\n    } else {\n      return new Error(`AI processing failed: ${error.message}`);\n    }\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"error-handling-patterns",children:"Error Handling Patterns"}),"\n",(0,i.jsx)(n.h3,{id:"consistent-error-response-structure",children:"Consistent Error Response Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface ServiceError {\n  type: 'network' | 'quota' | 'invalid_input' | 'server' | 'unknown';\n  message: string;\n  retryable: boolean;\n  details?: any;\n}\n\nclass ServiceErrorHandler {\n  static handle(error: any): ServiceError {\n    // Network errors\n    if (error.code === 'NETWORK_ERROR' || !navigator.onLine) {\n      return {\n        type: 'network',\n        message: 'Network connection lost. Please check your internet connection.',\n        retryable: true\n      };\n    }\n    \n    // Rate limiting / quota errors\n    if (error.message?.includes('quota') || error.status === 429) {\n      return {\n        type: 'quota',\n        message: 'Service quota exceeded. Please try again later.',\n        retryable: true\n      };\n    }\n    \n    // Invalid input\n    if (error.status >= 400 && error.status < 500) {\n      return {\n        type: 'invalid_input',\n        message: error.message || 'Invalid request. Please check your input.',\n        retryable: false\n      };\n    }\n    \n    // Server errors\n    if (error.status >= 500) {\n      return {\n        type: 'server',\n        message: 'Service temporarily unavailable. Please try again.',\n        retryable: true\n      };\n    }\n    \n    // Unknown errors\n    return {\n      type: 'unknown',\n      message: error.message || 'An unexpected error occurred.',\n      retryable: false,\n      details: error\n    };\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"retry-logic-implementation",children:"Retry Logic Implementation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"class RetryableService {\n  static async withRetry<T>(\n    operation: () => Promise<T>,\n    maxRetries: number = 3,\n    baseDelay: number = 1000\n  ): Promise<T> {\n    let lastError: ServiceError;\n    \n    for (let attempt = 1; attempt <= maxRetries; attempt++) {\n      try {\n        return await operation();\n      } catch (error) {\n        const serviceError = ServiceErrorHandler.handle(error);\n        lastError = serviceError;\n        \n        // Don't retry non-retryable errors\n        if (!serviceError.retryable) {\n          throw serviceError;\n        }\n        \n        // Don't retry on last attempt\n        if (attempt === maxRetries) {\n          throw serviceError;\n        }\n        \n        // Exponential backoff\n        const delay = baseDelay * Math.pow(2, attempt - 1);\n        await new Promise(resolve => setTimeout(resolve, delay));\n      }\n    }\n    \n    throw lastError!;\n  }\n}\n\n// Usage example\nconst generateMetadataWithRetry = async (image: File, instructions: string) => {\n  return RetryableService.withRetry(\n    () => geminiService.generatePhotoMetadata(image, instructions),\n    3, // max 3 retries\n    1000 // start with 1 second delay\n  );\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"service-configuration",children:"Service Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"environment-based-configuration",children:"Environment-Based Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// config/services.ts\ninterface ServiceConfig {\n  gemini: {\n    apiKey: string;\n    model: string;\n    timeout: number;\n  };\n  smugmug: {\n    baseUrl: string;\n    timeout: number;\n    mockMode: boolean;\n  };\n}\n\nconst getServiceConfig = (): ServiceConfig => {\n  const apiKey = import.meta.env.VITE_API_KEY || process.env.API_KEY;\n  \n  if (!apiKey) {\n    throw new Error('API_KEY environment variable is required');\n  }\n  \n  return {\n    gemini: {\n      apiKey,\n      model: 'gemini-1.5-flash',\n      timeout: 30000\n    },\n    smugmug: {\n      baseUrl: 'https://api.smugmug.com/api/v2',\n      timeout: 15000,\n      mockMode: process.env.NODE_ENV === 'development'\n    }\n  };\n};\n\nexport const serviceConfig = getServiceConfig();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"service-factory-pattern",children:"Service Factory Pattern"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// services/factory.ts\ninterface ServiceFactory {\n  createSmugMugService(): SmugMugService;\n  createGeminiService(): GeminiService;\n}\n\nclass ProductionServiceFactory implements ServiceFactory {\n  createSmugMugService(): SmugMugService {\n    if (serviceConfig.smugmug.mockMode) {\n      return new MockSmugMugService();\n    }\n    return new RealSmugMugService(serviceConfig.smugmug);\n  }\n  \n  createGeminiService(): GeminiService {\n    return new GeminiService(serviceConfig.gemini.apiKey);\n  }\n}\n\nclass TestServiceFactory implements ServiceFactory {\n  createSmugMugService(): SmugMugService {\n    return new MockSmugMugService();\n  }\n  \n  createGeminiService(): GeminiService {\n    return new MockGeminiService(); // Returns predictable test data\n  }\n}\n\nexport const serviceFactory: ServiceFactory = \n  process.env.NODE_ENV === 'test' \n    ? new TestServiceFactory()\n    : new ProductionServiceFactory();\n"})}),"\n",(0,i.jsx)(n.h2,{id:"testing-service-layer",children:"Testing Service Layer"}),"\n",(0,i.jsx)(n.h3,{id:"service-testing-patterns",children:"Service Testing Patterns"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// __tests__/services/geminiService.test.ts\ndescribe('GeminiService', () => {\n  let geminiService: GeminiService;\n  let mockFile: File;\n  \n  beforeEach(() => {\n    geminiService = new GeminiService('test-api-key');\n    mockFile = new File(['test'], 'test.jpg', { type: 'image/jpeg' });\n  });\n  \n  it('should generate metadata for valid image', async () => {\n    const metadata = await geminiService.generatePhotoMetadata(mockFile);\n    \n    expect(metadata).toHaveProperty('title');\n    expect(metadata).toHaveProperty('description');\n    expect(metadata).toHaveProperty('keywords');\n    expect(Array.isArray(metadata.keywords)).toBe(true);\n  });\n  \n  it('should handle quota exceeded error', async () => {\n    // Mock quota exceeded response\n    jest.spyOn(geminiService, 'generatePhotoMetadata')\n      .mockRejectedValue(new Error('quota exceeded'));\n    \n    await expect(\n      geminiService.generatePhotoMetadata(mockFile)\n    ).rejects.toThrow('AI service quota exceeded');\n  });\n  \n  it('should validate response structure', async () => {\n    // Mock invalid response\n    jest.spyOn(JSON, 'parse')\n      .mockReturnValue({ title: 'test' }); // missing required fields\n    \n    await expect(\n      geminiService.generatePhotoMetadata(mockFile)\n    ).rejects.toThrow('Missing required field');\n  });\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:"This service layer architecture provides a clean separation of concerns, making the application maintainable, testable, and easy to extend with new external services."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Next"}),": Explore the complete project and see these patterns in action by running the application locally."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(g,{...e})}):g(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>s});var t=r(6540);const i={},a=t.createContext(i);function o(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);